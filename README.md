[![Build Status](https://travis-ci.org/lsnq/shri-homework-04-06.svg?branch=master)](https://travis-ci.org/lsnq/shri-homework-04-06)

### ШРИ. Домашние задания 04, 05, 06

#### 04. Инфраструктура
Установка зависимостей
````
yarn
````
Инициализация проекта
````
yarn build
````
Запуск среды разработки
````
yarn start:dev
````

Сборку проекта осуществляет вебпак отслеживая исходники в директории /app.
Клиентская часть минифицируется и собирается в бандлы, серверные файлы просто 
копируются в /dist без изменений. Идея была в том, чтобы в процессе разработки
наблюдать проект в таком же виде, в каком он будет собран в продакшн и не
потерять разного рода зависимости в процессе сборки.

За изменениями серверного кода следит nodemon, после чего его проксирует browserSync.
Нужна была простая живая перезагрузка страницы без накручивания webpack middleware 
и подобных решений. И так получившийся результат кажется мне каким-то неправильным 
и избыточным, но к более элегантной реализации так и не пришел.

CI/CD взаимодействие с GitHub, Travis и Heroku настроено.

* В случае пулл-реквеста:
  * Travis проверяет код (линтеры, тесты)
  * Собирает проект
  * Heroku разворачивает образ в review-режиме
* В случае пуша в мастер
  * Travis проверяет код (линтеры, тесты)
  * Собирает проект
  * Разворачивает приложение на heroku в staging-mode
* В случае выставления тега
  * Travis проверяет код (линтеры, тесты)
  * Собирает проект
  * Разворачивает приложение на heroku в production-mode

#### 05. NodeJS
В рамках домашнего задания реализовано приложение node + express.
##### Возможности
- приложение показывает список веток репозитория, можно выбрать ветку
- для выбранной ветки можно смотреть дерево файлов
- для выбранной ветки можно смотреть историю коммитов
- для выбранного коммита можно смотреть дерево файлов, как и для ветки
- одновременно отображается текущий уровень дерева файлов, можно перейти по ссылкам во вложенные папки или подняться 
на любой уровень выше
- можно смотреть содержимое файлов

##### Реализация

- шаблонизация на сервере, шаблоны написаны на pug
- работа с git через CLI через child_process.exec
- для асинхронных операций используются конструкции async/await
- путь к папке с репозиторием хранится в конфигурационном файле 
- ссылка на репозиторий указывается в package.json


#### 06. Тесты
Эта часть задания далась мне сложнее всего, честное слово.
Приложение построено следующим образом:
При запросе к серверу формируется git команда, формирующаяся на основе полученных
от роутера параметров. child_process.exec выполняет команду, после чего
js парсит результат выполнения по одному из трех сценариев. Результат
в виде объектов передается в шаблоны.

Модульные тесты покрывают выполнение запросов по описанным в app/git.js сценариям
и проверяют корректность полученных объектов.
Запуск модульных тестов:
````
yarn test
````

Интеграционные тесты покрывают все сценарии предполагаемого пользовательского взаимодействия.
Запуск интеграционных тестов:
````
selenium-standalone start --version=3.4.0
hermione
````

  
---

##### Заметки (в основном для себя)
1.1 Чтобы heroku собирал Dockerfile по heroku.yml вместо деплоя сурсов из репозитория, жизненно необходимо указать 
stack - container. В случае работы с pipeline имя приложения указывается явно.
```
heroku stack:set -a <APP_NAME> container
```

1.2 Иногда, если прочитать документацию чуть внимательнее, можно сэкономить пару дней.